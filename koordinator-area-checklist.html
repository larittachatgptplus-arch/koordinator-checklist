<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laritta - Koordinator Area Checklist</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #D94A38;
            --primary-dark: #B83828;
            --secondary: #2C5F4F;
            --accent: #F4A261;
            --bg-light: #FAF9F6;
            --bg-white: #FFFFFF;
            --text-dark: #1A1A1A;
            --text-gray: #6B7280;
            --border: #E5E7EB;
            --success: #10B981;
            --warning: #F59E0B;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, #FFF5F0 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--bg-white);
            padding: 24px 0;
            box-shadow: var(--shadow);
            margin-bottom: 32px;
            border-bottom: 3px solid var(--primary);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
            color: white;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-dark);
        }

        .subtitle {
            font-size: 14px;
            color: var(--text-gray);
            font-weight: 500;
        }

        .tabs {
            display: flex;
            gap: 8px;
            background: var(--bg-white);
            padding: 8px;
            border-radius: 16px;
            box-shadow: var(--shadow);
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: var(--text-gray);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        .tab-btn:hover {
            background: var(--bg-light);
            color: var(--text-dark);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 24px;
            border: 1px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--bg-light);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 14px;
        }

        input[type="text"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            font-family: 'Plus Jakarta Sans', sans-serif;
            transition: all 0.3s ease;
            background: var(--bg-white);
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(217, 74, 56, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Plus Jakarta Sans', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(217, 74, 56, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #234a3d;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }

        .task-list {
            display: grid;
            gap: 16px;
        }

        .task-item {
            background: linear-gradient(135deg, #FFF 0%, var(--bg-light) 100%);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateX(4px);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .task-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .task-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-priority {
            background: #FEE2E2;
            color: #991B1B;
        }

        .badge-deadline {
            background: #DBEAFE;
            color: #1E40AF;
        }

        .badge-status {
            background: #D1FAE5;
            color: #065F46;
        }

        .badge-pending {
            background: #FEF3C7;
            color: #92400E;
        }

        .coordinator-checklist {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 2px solid var(--bg-light);
        }

        .coordinator-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: var(--bg-white);
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .coordinator-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .check-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .check-box {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .check-box.checked {
            background: var(--success);
            border-color: var(--success);
        }

        .check-box.checked::after {
            content: '‚úì';
            color: white;
            font-weight: 700;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--bg-white) 0%, var(--bg-light) 100%);
            padding: 24px;
            border-radius: 16px;
            border: 2px solid var(--border);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        .template-card {
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .template-title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .template-preview {
            font-size: 14px;
            color: var(--text-gray);
            line-height: 1.6;
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-light);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-white);
            padding: 32px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--bg-light);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--text-dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-gray);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--bg-light);
            color: var(--text-dark);
        }

        .coordinator-select {
            display: grid;
            gap: 12px;
            margin: 16px 0;
        }

        .coordinator-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: var(--bg-light);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .coordinator-checkbox:hover {
            background: #FFE8E3;
        }

        .coordinator-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-gray);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 18px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .tabs {
                width: 100%;
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">L</div>
                <div>
                    <h1>Koordinator Area Checklist</h1>
                    <div class="subtitle">Sales & Marketing - Area Coordinator Management</div>
                </div>
            </div>
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
                <button class="tab-btn" onclick="switchTab('assign')">üìù Assign Task</button>
                <button class="tab-btn" onclick="switchTab('tasks')">‚úÖ Tugas Aktif</button>
                <button class="tab-btn" onclick="switchTab('history')">üìö Riwayat</button>
                <button class="tab-btn" onclick="switchTab('reminder')">üí¨ Reminder</button>
                <button class="tab-btn" onclick="switchTab('master')">‚öôÔ∏è Master Data</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Global Stats -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üåç Statistik Global</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalTasks">0</div>
                        <div class="stat-label">Total Tugas Aktif</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedTasks">0</div>
                        <div class="stat-label">Tugas Selesai</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pendingTasks">0</div>
                        <div class="stat-label">Tugas Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="overdueTask">0</div>
                        <div class="stat-label">Tugas Terlambat</div>
                    </div>
                </div>
            </div>

            <!-- Per Area Stats -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìç Statistik Per Area</h2>
                </div>
                <div id="coordinatorStats"></div>
            </div>
        </div>

        <!-- Assign Task Tab -->
        <div id="assign" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìù Buat Tugas Baru</h2>
                </div>
                <form id="taskForm">
                    <div class="form-group">
                        <label>Judul Tugas *</label>
                        <input type="text" id="taskTitle" placeholder="Contoh: Update Lagu Natal 2025" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Deskripsi Tugas</label>
                        <textarea id="taskDescription" placeholder="Detail tugas yang harus dikerjakan..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Kategori Tugas</label>
                        <select id="taskCategory">
                            <option value="">Pilih Kategori</option>
                            <option value="Audio/Visual">Audio/Visual</option>
                            <option value="Display">Display</option>
                            <option value="Promo">Promo</option>
                            <option value="Inventory">Inventory</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Training">Training</option>
                            <option value="Report">Report</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Deadline *</label>
                        <input type="date" id="taskDeadline" required>
                    </div>

                    <div class="form-group">
                        <label>Prioritas</label>
                        <select id="taskPriority">
                            <option value="Tinggi">üî¥ Tinggi</option>
                            <option value="Sedang" selected>üü° Sedang</option>
                            <option value="Rendah">üü¢ Rendah</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Assign ke Koordinator Area *</label>
                        <div class="coordinator-select" id="coordinatorSelect"></div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        ‚úÖ Assign Tugas
                    </button>
                </form>
            </div>
        </div>

        <!-- Active Tasks Tab -->
        <div id="tasks" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚úÖ Tugas Aktif</h2>
                    <button class="btn btn-secondary btn-small" onclick="refreshTasks()">üîÑ Refresh</button>
                </div>
                <div id="tasksList" class="task-list"></div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìö Riwayat Tugas</h2>
                    <select id="historyFilter" onchange="filterHistory()" class="btn btn-secondary btn-small" style="padding: 8px 16px;">
                        <option value="all">Semua</option>
                        <option value="completed">Selesai</option>
                        <option value="overdue">Terlambat</option>
                    </select>
                </div>
                <div id="historyList" class="task-list"></div>
            </div>
        </div>

        <!-- Reminder Tab -->
        <div id="reminder" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üí¨ Template Chat Reminder</h2>
                </div>
                <div class="template-grid" id="reminderTemplates"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üì§ Hasil Reminder</h2>
                </div>
                <div id="reminderOutput" style="display: none;">
                    <textarea id="reminderText" readonly style="font-family: 'JetBrains Mono', monospace; background: var(--bg-light); min-height: 200px;"></textarea>
                    <button class="btn btn-success" onclick="copyReminder()" style="margin-top: 12px;">
                        üìã Copy ke Clipboard
                    </button>
                </div>
            </div>
        </div>

        <!-- Master Data Tab -->
        <div id="master" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üè™ Master Toko</h2>
                    <button class="btn btn-primary btn-small" onclick="showAddStore()">+ Tambah Toko</button>
                </div>
                <div id="storeList"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üë• Master Koordinator Area</h2>
                    <button class="btn btn-primary btn-small" onclick="showAddCoordinator()">+ Tambah</button>
                </div>
                <div id="coordinatorList"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìã Master Kategori Tugas</h2>
                    <button class="btn btn-primary btn-small" onclick="showAddCategory()">+ Tambah</button>
                </div>
                <div id="categoryList"></div>
            </div>
        </div>
    </div>

    <!-- Modal Add Store -->
    <div id="storeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Toko Baru</h3>
                <button class="close-btn" onclick="closeModal('storeModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Nama Toko *</label>
                <input type="text" id="newStoreName" placeholder="Contoh: Laritta Cabang Surabaya 1">
            </div>
            <div class="form-group">
                <label>Kode Toko *</label>
                <input type="text" id="newStoreCode" placeholder="Contoh: SBY-01">
            </div>
            <div class="form-group">
                <label>Lokasi/Alamat</label>
                <textarea id="newStoreAddress" placeholder="Alamat lengkap toko..."></textarea>
            </div>
            <div class="form-group">
                <label>Assign ke Koordinator Area</label>
                <select id="newStoreCoordinator">
                    <option value="">Pilih Koordinator</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="addStore()">Simpan</button>
        </div>
    </div>

    <!-- Modal Add Coordinator -->
    <div id="coordinatorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Koordinator Area</h3>
                <button class="close-btn" onclick="closeModal('coordinatorModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Nama Koordinator *</label>
                <input type="text" id="newCoordinatorName" placeholder="Nama lengkap">
            </div>
            <div class="form-group">
                <label>Area *</label>
                <input type="text" id="newCoordinatorArea" placeholder="Contoh: Surabaya, Sidoarjo, Gresik">
            </div>
            <div class="form-group">
                <label>No. WhatsApp</label>
                <input type="text" id="newCoordinatorPhone" placeholder="08xx-xxxx-xxxx">
            </div>
            <div class="form-group">
                <label>Assign Toko</label>
                <div id="storeAssignList" class="coordinator-select"></div>
            </div>
            <button class="btn btn-primary" onclick="addCoordinator()">Simpan</button>
        </div>
    </div>

    <!-- Modal Add Category -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Kategori Tugas</h3>
                <button class="close-btn" onclick="closeModal('categoryModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Nama Kategori *</label>
                <input type="text" id="newCategoryName" placeholder="Nama kategori">
            </div>
            <button class="btn btn-primary" onclick="addCategory()">Simpan</button>
        </div>
    </div>

    <script>
        // Data Storage menggunakan LocalStorage (bisa diganti dengan Firebase)
        const STORAGE_KEY = 'laritta_tasks';
        const COORDINATOR_KEY = 'laritta_coordinators';
        const CATEGORY_KEY = 'laritta_categories';
        const STORE_KEY = 'laritta_stores';

        // Initialize default stores
        let stores = JSON.parse(localStorage.getItem(STORE_KEY)) || [
        {
                "id": 1,
                "name": "Borobudur - Tangerang",
                "code": "TNG-001",
                "address": "Hub: Tangerang",
                "area": "Area 1 ‚Äì Agus Budi Prayitno"
        },
        {
                "id": 2,
                "name": "Merdeka - Tangerang",
                "code": "TNG-002",
                "address": "Hub: Tangerang",
                "area": "Area 1 ‚Äì Agus Budi Prayitno"
        },
        {
                "id": 3,
                "name": "Halim - Tangerang",
                "code": "TNG-003",
                "address": "Hub: Tangerang",
                "area": "Area 1 ‚Äì Agus Budi Prayitno"
        },
        {
                "id": 4,
                "name": "Poris - Tangerang",
                "code": "TNG-004",
                "address": "Hub: Tangerang",
                "area": "Area 1 ‚Äì Agus Budi Prayitno"
        },
        {
                "id": 5,
                "name": "Ciledug - Tangerang",
                "code": "TNG-005",
                "address": "Hub: Tangerang",
                "area": "Area 1 ‚Äì Agus Budi Prayitno"
        },
        {
                "id": 6,
                "name": "Periuk - Tangerang",
                "code": "TNG-006",
                "address": "Hub: Tangerang",
                "area": "Area 1 ‚Äì Agus Budi Prayitno"
        },
        {
                "id": 7,
                "name": "Graha Raya - Tangerang",
                "code": "TNG-007",
                "address": "Hub: Tangerang",
                "area": "Area 1 ‚Äì Agus Budi Prayitno"
        },
        {
                "id": 8,
                "name": "Nias",
                "code": "SBY-001",
                "address": "Hub: Surabaya Raya",
                "area": "Area 2 ‚Äì Isa Yuhani"
        },
        {
                "id": 9,
                "name": "Darmahusada",
                "code": "SBY-002",
                "address": "Hub: Surabaya Raya",
                "area": "Area 2 ‚Äì Isa Yuhani"
        },
        {
                "id": 10,
                "name": "Kutai",
                "code": "SBY-003",
                "address": "Hub: Surabaya Raya",
                "area": "Area 2 ‚Äì Isa Yuhani"
        },
        {
                "id": 11,
                "name": "Barata",
                "code": "SBY-004",
                "address": "Hub: Surabaya Raya",
                "area": "Area 2 ‚Äì Isa Yuhani"
        },
        {
                "id": 12,
                "name": "Ketintang",
                "code": "SBY-005",
                "address": "Hub: Surabaya Raya",
                "area": "Area 2 ‚Äì Isa Yuhani"
        },
        {
                "id": 13,
                "name": "Menganti - Gresik",
                "code": "SBY-006",
                "address": "Hub: Surabaya Raya",
                "area": "Area 2 ‚Äì Isa Yuhani"
        },
        {
                "id": 14,
                "name": "Wiyung",
                "code": "SBY-007",
                "address": "Hub: Surabaya Raya",
                "area": "Area 2 ‚Äì Isa Yuhani"
        },
        {
                "id": 15,
                "name": "ST.Gubeng",
                "code": "SBY-008",
                "address": "Hub: Surabaya Raya",
                "area": "Area 2 ‚Äì Isa Yuhani"
        },
        {
                "id": 16,
                "name": "Gayung Sari",
                "code": "SBY-009",
                "address": "Hub: Surabaya Raya",
                "area": "Area 3 ‚Äì Rosyat Ely Delia"
        },
        {
                "id": 17,
                "name": "Rungkut",
                "code": "SBY-010",
                "address": "Hub: Surabaya Raya",
                "area": "Area 3 ‚Äì Rosyat Ely Delia"
        },
        {
                "id": 18,
                "name": "Rungkut Tengah",
                "code": "SBY-011",
                "address": "Hub: Surabaya Raya",
                "area": "Area 3 ‚Äì Rosyat Ely Delia"
        },
        {
                "id": 19,
                "name": "Tropodo - Sidoarjo",
                "code": "SBY-012",
                "address": "Hub: Surabaya Raya",
                "area": "Area 3 ‚Äì Rosyat Ely Delia"
        },
        {
                "id": 20,
                "name": "Deltasari - Sidoarjo",
                "code": "SBY-013",
                "address": "Hub: Surabaya Raya",
                "area": "Area 3 ‚Äì Rosyat Ely Delia"
        },
        {
                "id": 21,
                "name": "Wage",
                "code": "SBY-014",
                "address": "Hub: Surabaya Raya",
                "area": "Area 3 ‚Äì Rosyat Ely Delia"
        },
        {
                "id": 22,
                "name": "Darmo Permai",
                "code": "SBY-015",
                "address": "Hub: Surabaya Raya",
                "area": "Area 3 ‚Äì Rosyat Ely Delia"
        },
        {
                "id": 23,
                "name": "Manukan",
                "code": "SBY-016",
                "address": "Hub: Surabaya Raya",
                "area": "Area 3 ‚Äì Rosyat Ely Delia"
        },
        {
                "id": 24,
                "name": "Perak",
                "code": "SBY-017",
                "address": "Hub: Surabaya Raya",
                "area": "Area 4 ‚Äì Masita Krismi Adianty"
        },
        {
                "id": 25,
                "name": "Kapas Krampung",
                "code": "SBY-018",
                "address": "Hub: Surabaya Raya",
                "area": "Area 4 ‚Äì Masita Krismi Adianty"
        },
        {
                "id": 26,
                "name": "Iskandar Muda",
                "code": "SBY-019",
                "address": "Hub: Surabaya Raya",
                "area": "Area 4 ‚Äì Masita Krismi Adianty"
        },
        {
                "id": 27,
                "name": "Kedung Cowek",
                "code": "SBY-020",
                "address": "Hub: Surabaya Raya",
                "area": "Area 4 ‚Äì Masita Krismi Adianty"
        },
        {
                "id": 28,
                "name": "Mulyosari",
                "code": "SBY-021",
                "address": "Hub: Surabaya Raya",
                "area": "Area 4 ‚Äì Masita Krismi Adianty"
        },
        {
                "id": 29,
                "name": "Demak",
                "code": "SBY-022",
                "address": "Hub: Surabaya Raya",
                "area": "Area 4 ‚Äì Masita Krismi Adianty"
        },
        {
                "id": 30,
                "name": "Gresik Kota Baru",
                "code": "SBY-023",
                "address": "Hub: Surabaya Raya",
                "area": "Area 4 ‚Äì Masita Krismi Adianty"
        },
        {
                "id": 31,
                "name": "Panglima Sudirman - Gresik",
                "code": "SBY-024",
                "address": "Hub: Surabaya Raya",
                "area": "Area 4 ‚Äì Masita Krismi Adianty"
        },
        {
                "id": 32,
                "name": "Bangkalan - Madura",
                "code": "MDR-001",
                "address": "Hub: Madura",
                "area": "Area 4 ‚Äì Masita Krismi Adianty"
        },
        {
                "id": 33,
                "name": "Krian - Sidoarjo",
                "code": "SBY-025",
                "address": "Hub: Surabaya Raya",
                "area": "Area 5 ‚Äì Ita Tri Handaynie"
        },
        {
                "id": 34,
                "name": "Sepanjang - Sidoarjo",
                "code": "SBY-026",
                "address": "Hub: Surabaya Raya",
                "area": "Area 5 ‚Äì Ita Tri Handaynie"
        },
        {
                "id": 35,
                "name": "Dukuh Kupang",
                "code": "SBY-027",
                "address": "Hub: Surabaya Raya",
                "area": "Area 5 ‚Äì Ita Tri Handaynie"
        },
        {
                "id": 36,
                "name": "Diponegoro - Sidoarjo",
                "code": "SBY-028",
                "address": "Hub: Surabaya Raya",
                "area": "Area 5 ‚Äì Ita Tri Handaynie"
        },
        {
                "id": 37,
                "name": "Cemengkalang",
                "code": "SBY-029",
                "address": "Hub: Surabaya Raya",
                "area": "Area 5 ‚Äì Ita Tri Handaynie"
        },
        {
                "id": 38,
                "name": "Sukodono",
                "code": "SBY-030",
                "address": "Hub: Surabaya Raya",
                "area": "Area 5 ‚Äì Ita Tri Handaynie"
        },
        {
                "id": 39,
                "name": "Candi - Sidoarjo",
                "code": "SBY-031",
                "address": "Hub: Surabaya Raya",
                "area": "Area 5 ‚Äì Ita Tri Handaynie"
        },
        {
                "id": 40,
                "name": "Tanggulangin",
                "code": "SBY-032",
                "address": "Hub: Surabaya Raya",
                "area": "Area 5 ‚Äì Ita Tri Handaynie"
        }
];

        // Initialize default coordinators
        let coordinators = JSON.parse(localStorage.getItem(COORDINATOR_KEY)) || [
        {
                "id": 1,
                "name": "Agus Budi Prayitno",
                "area": "Tangerang",
                "phone": "",
                "stores": [
                        1,
                        2,
                        3,
                        4,
                        5,
                        6,
                        7
                ]
        },
        {
                "id": 2,
                "name": "Isa Yuhani",
                "area": "Surabaya Raya",
                "phone": "",
                "stores": [
                        8,
                        9,
                        10,
                        11,
                        12,
                        13,
                        14,
                        15
                ]
        },
        {
                "id": 3,
                "name": "Rosyat Ely Delia",
                "area": "Surabaya Raya",
                "phone": "",
                "stores": [
                        16,
                        17,
                        18,
                        19,
                        20,
                        21,
                        22,
                        23
                ]
        },
        {
                "id": 4,
                "name": "Masita Krismi Adianty",
                "area": "Surabaya Raya",
                "phone": "",
                "stores": [
                        24,
                        25,
                        26,
                        27,
                        28,
                        29,
                        30,
                        31,
                        32
                ]
        },
        {
                "id": 5,
                "name": "Ita Tri Handaynie",
                "area": "Surabaya Raya",
                "phone": "",
                "stores": [
                        33,
                        34,
                        35,
                        36,
                        37,
                        38,
                        39,
                        40
                ]
        }
];

        let categories = JSON.parse(localStorage.getItem(CATEGORY_KEY)) || [
            "Audio/Visual", "Display", "Promo", "Inventory", "Maintenance", "Training", "Report", "Lainnya"
        ];

        let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

        // Save to storage
        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
            localStorage.setItem(COORDINATOR_KEY, JSON.stringify(coordinators));
            localStorage.setItem(CATEGORY_KEY, JSON.stringify(categories));
            localStorage.setItem(STORE_KEY, JSON.stringify(stores));
        }

        // Tab switching
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') updateDashboard();
            if (tabName === 'tasks') renderTasks();
            if (tabName === 'history') renderHistory();
            if (tabName === 'reminder') renderReminderTemplates();
            if (tabName === 'master') renderMasterData();
        }

        // Initialize coordinator checkboxes
        function initCoordinatorSelect() {
            const container = document.getElementById('coordinatorSelect');
            container.innerHTML = coordinators.map(coord => `
                <label class="coordinator-checkbox">
                    <input type="checkbox" name="coordinator" value="${coord.id}">
                    <span><strong>${coord.name}</strong> - ${coord.area}</span>
                </label>
            `).join('');
        }

        // Task Form Submit
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const category = document.getElementById('taskCategory').value;
            const deadline = document.getElementById('taskDeadline').value;
            const priority = document.getElementById('taskPriority').value;
            
            const selectedCoordinators = Array.from(
                document.querySelectorAll('input[name="coordinator"]:checked')
            ).map(cb => {
                const coordId = parseInt(cb.value);
                return coordinators.find(c => c.id === coordId);
            });

            if (selectedCoordinators.length === 0) {
                alert('Pilih minimal 1 koordinator area!');
                return;
            }

            const task = {
                id: Date.now(),
                title,
                description,
                category,
                deadline,
                priority,
                createdAt: new Date().toISOString(),
                coordinators: selectedCoordinators.map(coord => ({
                    ...coord,
                    checked: false,
                    checkedAt: null
                })),
                status: 'active'
            };

            tasks.push(task);
            saveData();
            
            alert('‚úÖ Tugas berhasil di-assign!');
            this.reset();
            initCoordinatorSelect();
            updateDashboard();
        });

        // Render Tasks
        function renderTasks() {
            const container = document.getElementById('tasksList');
            const activeTasks = tasks.filter(t => t.status === 'active');
            
            if (activeTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <div class="empty-state-text">Belum ada tugas aktif</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = activeTasks.map(task => {
                const completedCount = task.coordinators.filter(c => c.checked).length;
                const totalCount = task.coordinators.length;
                const isOverdue = new Date(task.deadline) < new Date() && completedCount < totalCount;
                
                return `
                    <div class="task-item">
                        <div class="task-header">
                            <div>
                                <div class="task-title">${task.title}</div>
                                <div class="task-meta">
                                    <span class="badge badge-priority">${task.priority}</span>
                                    <span class="badge badge-deadline">‚è∞ ${formatDate(task.deadline)}</span>
                                    <span class="badge ${completedCount === totalCount ? 'badge-status' : (isOverdue ? 'badge-priority' : 'badge-pending')}">
                                        ${completedCount}/${totalCount} Selesai
                                    </span>
                                    ${task.category ? `<span class="badge" style="background: #E0E7FF; color: #3730A3;">${task.category}</span>` : ''}
                                </div>
                            </div>
                        </div>
                        ${task.description ? `<p style="color: var(--text-gray); margin: 12px 0;">${task.description}</p>` : ''}
                        
                        <div class="coordinator-checklist">
                            ${task.coordinators.map((coord, idx) => `
                                <div class="coordinator-item">
                                    <span class="coordinator-name">
                                        ${coord.name} - ${coord.area}
                                        ${coord.checked ? `<span style="color: var(--success); font-size: 12px;"> ‚úì ${formatDateTime(coord.checkedAt)}</span>` : ''}
                                    </span>
                                    <div class="check-status">
                                        <div class="check-box ${coord.checked ? 'checked' : ''}" 
                                             onclick="toggleCheck(${task.id}, ${idx})"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle Checklist
        function toggleCheck(taskId, coordIndex) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.coordinators[coordIndex].checked = !task.coordinators[coordIndex].checked;
                task.coordinators[coordIndex].checkedAt = task.coordinators[coordIndex].checked ? new Date().toISOString() : null;
                
                // Check if all completed
                const allCompleted = task.coordinators.every(c => c.checked);
                if (allCompleted) {
                    task.status = 'completed';
                    task.completedAt = new Date().toISOString();
                }
                
                saveData();
                renderTasks();
                updateDashboard();
            }
        }

        // Render History
        function renderHistory() {
            const container = document.getElementById('historyList');
            const filter = document.getElementById('historyFilter').value;
            
            let filteredTasks = [...tasks];
            if (filter === 'completed') {
                filteredTasks = tasks.filter(t => t.status === 'completed');
            } else if (filter === 'overdue') {
                filteredTasks = tasks.filter(t => {
                    const allCompleted = t.coordinators.every(c => c.checked);
                    return new Date(t.deadline) < new Date() && !allCompleted;
                });
            }

            if (filteredTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <div class="empty-state-text">Belum ada riwayat</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredTasks.sort((a, b) => 
                new Date(b.createdAt) - new Date(a.createdAt)
            ).map(task => {
                const completedCount = task.coordinators.filter(c => c.checked).length;
                const totalCount = task.coordinators.length;
                
                return `
                    <div class="task-item">
                        <div class="task-header">
                            <div>
                                <div class="task-title">${task.title}</div>
                                <div class="task-meta">
                                    <span class="badge badge-deadline">üìÖ Created: ${formatDate(task.createdAt)}</span>
                                    <span class="badge badge-deadline">‚è∞ Deadline: ${formatDate(task.deadline)}</span>
                                    <span class="badge ${task.status === 'completed' ? 'badge-status' : 'badge-priority'}">
                                        ${task.status === 'completed' ? '‚úÖ Selesai' : '‚è≥ Incomplete'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="coordinator-checklist">
                            ${task.coordinators.map(coord => `
                                <div class="coordinator-item">
                                    <span class="coordinator-name">
                                        ${coord.name} - ${coord.area}
                                    </span>
                                    <div class="check-status">
                                        <div class="check-box ${coord.checked ? 'checked' : ''}"></div>
                                        ${coord.checked ? `<span style="font-size: 12px; color: var(--success);">${formatDateTime(coord.checkedAt)}</span>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterHistory() {
            renderHistory();
        }

        // Render Reminder Templates
        function renderReminderTemplates() {
            const container = document.getElementById('reminderTemplates');
            const activeTasks = tasks.filter(t => t.status === 'active');
            
            if (activeTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <div class="empty-state-text">Belum ada tugas untuk reminder</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = activeTasks.map(task => {
                const uncheckedCoords = task.coordinators.filter(c => !c.checked);
                
                if (uncheckedCoords.length === 0) return '';

                return `
                    <div class="template-card" onclick="generateReminder(${task.id})">
                        <div class="template-title">${task.title}</div>
                        <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">
                            ‚è∞ Deadline: ${formatDate(task.deadline)}
                        </div>
                        <div style="font-size: 12px; color: var(--warning); margin-top: 4px;">
                            ‚ö†Ô∏è ${uncheckedCoords.length} koordinator belum selesai
                        </div>
                        <div class="template-preview">
                            Klik untuk generate reminder WhatsApp ‚Üí
                        </div>
                    </div>
                `;
            }).filter(Boolean).join('');
        }

        // Generate Reminder
        function generateReminder(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const uncheckedCoords = task.coordinators.filter(c => !c.checked);
            const daysLeft = Math.ceil((new Date(task.deadline) - new Date()) / (1000 * 60 * 60 * 24));
            
            let message = `üîî *REMINDER TUGAS - ${task.title}*\n\n`;
            message += `‚è∞ *Deadline:* ${formatDate(task.deadline)} (${daysLeft} hari lagi)\n`;
            message += `üìã *Kategori:* ${task.category || 'Umum'}\n`;
            message += `üî¥ *Prioritas:* ${task.priority}\n\n`;
            
            if (task.description) {
                message += `üìù *Deskripsi:*\n${task.description}\n\n`;
            }
            
            message += `‚ö†Ô∏è *Yang belum menyelesaikan:*\n`;
            uncheckedCoords.forEach((coord, idx) => {
                const coordStores = stores.filter(s => coord.stores && coord.stores.includes(s.id));
                message += `${idx + 1}. ${coord.name} - ${coord.area}`;
                if (coordStores.length > 0) {
                    message += ` (${coordStores.length} toko)`;
                }
                message += `\n`;
            });
            
            message += `\n‚úÖ Mohon segera dicek dan diselesaikan di semua toko area masing-masing ya!\n`;
            message += `\n_Pesan otomatis dari Laritta Koordinator Area Checklist_`;

            document.getElementById('reminderText').value = message;
            document.getElementById('reminderOutput').style.display = 'block';
            
            // Scroll to output
            document.getElementById('reminderOutput').scrollIntoView({ behavior: 'smooth' });
        }

        // Copy Reminder
        function copyReminder() {
            const text = document.getElementById('reminderText');
            text.select();
            document.execCommand('copy');
            alert('‚úÖ Reminder berhasil dicopy ke clipboard!');
        }

        // Update Dashboard
        function updateDashboard() {
            const activeTasks = tasks.filter(t => t.status === 'active');
            const completedTasks = tasks.filter(t => t.status === 'completed');
            
            let pendingCount = 0;
            let overdueCount = 0;
            
            activeTasks.forEach(task => {
                const unchecked = task.coordinators.filter(c => !c.checked).length;
                if (unchecked > 0) {
                    pendingCount++;
                    if (new Date(task.deadline) < new Date()) {
                        overdueCount++;
                    }
                }
            });

            document.getElementById('totalTasks').textContent = activeTasks.length;
            document.getElementById('completedTasks').textContent = completedTasks.length;
            document.getElementById('pendingTasks').textContent = pendingCount;
            document.getElementById('overdueTask').textContent = overdueCount;

            // Coordinator stats per area
            const statsContainer = document.getElementById('coordinatorStats');
            const coordStats = coordinators.map(coord => {
                const coordTasks = tasks.filter(t => 
                    t.status === 'active' && t.coordinators.some(c => c.id === coord.id)
                );
                const completedCount = coordTasks.filter(t => {
                    const coordData = t.coordinators.find(c => c.id === coord.id);
                    return coordData && coordData.checked;
                }).length;

                // Get stores for this coordinator
                const coordStores = stores.filter(s => coord.stores && coord.stores.includes(s.id));

                return {
                    ...coord,
                    total: coordTasks.length,
                    completed: completedCount,
                    pending: coordTasks.length - completedCount,
                    storeList: coordStores
                };
            });

            statsContainer.innerHTML = coordStats.map(stat => `
                <div style="background: var(--bg-light); border-radius: 12px; padding: 20px; margin: 12px 0; border: 2px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <span class="coordinator-name" style="font-size: 18px;">${stat.name}</span>
                            <div style="font-size: 14px; color: var(--text-gray); margin-top: 4px;">üìç ${stat.area}</div>
                            ${stat.phone ? `<div style="font-size: 14px; color: var(--text-gray); margin-top: 2px;">üì± ${stat.phone}</div>` : ''}
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap; justify-content: flex-end;">
                            <span class="badge badge-status">${stat.completed} Selesai</span>
                            <span class="badge badge-pending">${stat.pending} Pending</span>
                            <span class="badge" style="background: var(--bg-white); color: var(--text-dark); border: 1px solid var(--border);">${stat.total} Total</span>
                        </div>
                    </div>
                    ${stat.storeList.length > 0 ? `
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                            <div style="font-size: 13px; font-weight: 600; color: var(--text-gray); margin-bottom: 8px;">üè™ Toko yang dipegang (${stat.storeList.length}):</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                                ${stat.storeList.map(store => `
                                    <span style="background: var(--bg-white); padding: 4px 10px; border-radius: 6px; font-size: 12px; border: 1px solid var(--border);">
                                        ${store.code} - ${store.name}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    ` : '<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); font-size: 13px; color: var(--text-gray);">Belum ada toko yang di-assign</div>'}
                </div>
            `).join('');
        }

        // Render Master Data
        function renderMasterData() {
            // Stores
            const storeListContainer = document.getElementById('storeList');
            if (stores.length === 0) {
                storeListContainer.innerHTML = `
                    <div class="empty-state" style="padding: 40px 20px;">
                        <div class="empty-state-icon" style="font-size: 48px;">üè™</div>
                        <div class="empty-state-text">Belum ada toko</div>
                    </div>
                `;
            } else {
                storeListContainer.innerHTML = stores.map(store => {
                    const coord = coordinators.find(c => c.stores && c.stores.includes(store.id));
                    return `
                        <div class="coordinator-item" style="margin: 8px 0;">
                            <div>
                                <span class="coordinator-name">${store.code} - ${store.name}</span>
                                ${store.address ? `<div style="font-size: 13px; color: var(--text-gray); margin-top: 2px;">üìç ${store.address}</div>` : ''}
                                ${coord ? `<div style="font-size: 13px; color: var(--secondary); margin-top: 2px; font-weight: 600;">üë§ ${coord.name} (${coord.area})</div>` : '<div style="font-size: 13px; color: var(--warning); margin-top: 2px;">‚ö†Ô∏è Belum di-assign ke koordinator</div>'}
                            </div>
                            <button class="btn btn-small" style="background: #EF4444; color: white;" onclick="deleteStore(${store.id})">üóëÔ∏è</button>
                        </div>
                    `;
                }).join('');
            }

            // Coordinators
            const coordList = document.getElementById('coordinatorList');
            coordList.innerHTML = coordinators.map(coord => {
                const storeCount = coord.stores ? coord.stores.length : 0;
                return `
                    <div class="coordinator-item" style="margin: 8px 0;">
                        <div>
                            <span class="coordinator-name">${coord.name}</span>
                            <span style="font-size: 14px; color: var(--text-gray); margin-left: 8px;">${coord.area}</span>
                            ${coord.phone ? `<span style="font-size: 14px; color: var(--text-gray); margin-left: 8px;">üì± ${coord.phone}</span>` : ''}
                            <div style="font-size: 13px; color: var(--secondary); margin-top: 4px; font-weight: 600;">üè™ ${storeCount} toko</div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-small" style="background: var(--secondary); color: white;" onclick="editCoordinator(${coord.id})">‚úèÔ∏è Edit</button>
                            <button class="btn btn-small" style="background: #EF4444; color: white;" onclick="deleteCoordinator(${coord.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');

            // Categories
            const catList = document.getElementById('categoryList');
            catList.innerHTML = categories.map((cat, idx) => `
                <div class="coordinator-item" style="margin: 8px 0;">
                    <span class="coordinator-name">${cat}</span>
                    <button class="btn btn-small" style="background: #EF4444; color: white;" onclick="deleteCategory(${idx})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        // Modal functions
        function showAddStore() {
            // Populate coordinator dropdown
            const select = document.getElementById('newStoreCoordinator');
            select.innerHTML = '<option value="">Pilih Koordinator</option>' + 
                coordinators.map(coord => `<option value="${coord.id}">${coord.name} - ${coord.area}</option>`).join('');
            
            document.getElementById('storeModal').classList.add('active');
        }

        function showAddCoordinator() {
            // Populate store checklist
            const container = document.getElementById('storeAssignList');
            if (stores.length === 0) {
                container.innerHTML = '<div style="padding: 12px; color: var(--text-gray); font-size: 14px;">Belum ada toko. Tambahkan toko terlebih dahulu.</div>';
            } else {
                container.innerHTML = stores.map(store => `
                    <label class="coordinator-checkbox">
                        <input type="checkbox" name="assignedStore" value="${store.id}">
                        <span><strong>${store.code}</strong> - ${store.name}</span>
                    </label>
                `).join('');
            }
            
            document.getElementById('coordinatorModal').classList.add('active');
        }

        function showAddCategory() {
            document.getElementById('categoryModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function addStore() {
            const name = document.getElementById('newStoreName').value.trim();
            const code = document.getElementById('newStoreCode').value.trim();
            const address = document.getElementById('newStoreAddress').value.trim();
            const coordinatorId = document.getElementById('newStoreCoordinator').value;

            if (!name || !code) {
                alert('Nama Toko dan Kode Toko wajib diisi!');
                return;
            }

            // Check if code already exists
            if (stores.some(s => s.code === code)) {
                alert('Kode toko sudah digunakan!');
                return;
            }

            const newStore = {
                id: Date.now(),
                name,
                code,
                address
            };

            stores.push(newStore);

            // Assign to coordinator if selected
            if (coordinatorId) {
                const coord = coordinators.find(c => c.id === parseInt(coordinatorId));
                if (coord) {
                    if (!coord.stores) coord.stores = [];
                    coord.stores.push(newStore.id);
                }
            }

            saveData();
            closeModal('storeModal');
            renderMasterData();
            updateDashboard();
            
            // Clear form
            document.getElementById('newStoreName').value = '';
            document.getElementById('newStoreCode').value = '';
            document.getElementById('newStoreAddress').value = '';
            document.getElementById('newStoreCoordinator').value = '';
            
            alert('‚úÖ Toko berhasil ditambahkan!');
        }

        function deleteStore(id) {
            if (confirm('Yakin hapus toko ini?')) {
                // Remove from stores array
                stores = stores.filter(s => s.id !== id);
                
                // Remove from all coordinators
                coordinators.forEach(coord => {
                    if (coord.stores) {
                        coord.stores = coord.stores.filter(storeId => storeId !== id);
                    }
                });
                
                saveData();
                renderMasterData();
                updateDashboard();
            }
        }

        function addCoordinator() {
            const name = document.getElementById('newCoordinatorName').value.trim();
            const area = document.getElementById('newCoordinatorArea').value.trim();
            const phone = document.getElementById('newCoordinatorPhone').value.trim();

            if (!name || !area) {
                alert('Nama dan Area wajib diisi!');
                return;
            }

            // Get selected stores
            const selectedStores = Array.from(
                document.querySelectorAll('input[name="assignedStore"]:checked')
            ).map(cb => parseInt(cb.value));

            // Remove stores from other coordinators first
            coordinators.forEach(coord => {
                if (coord.stores) {
                    coord.stores = coord.stores.filter(storeId => !selectedStores.includes(storeId));
                }
            });

            coordinators.push({
                id: Date.now(),
                name,
                area,
                phone,
                stores: selectedStores
            });

            saveData();
            closeModal('coordinatorModal');
            renderMasterData();
            initCoordinatorSelect();
            updateDashboard();
            
            // Clear form
            document.getElementById('newCoordinatorName').value = '';
            document.getElementById('newCoordinatorArea').value = '';
            document.getElementById('newCoordinatorPhone').value = '';
            
            alert('‚úÖ Koordinator berhasil ditambahkan!');
        }

        function editCoordinator(id) {
            const coord = coordinators.find(c => c.id === id);
            if (!coord) return;

            // Populate form with existing data
            document.getElementById('newCoordinatorName').value = coord.name;
            document.getElementById('newCoordinatorArea').value = coord.area;
            document.getElementById('newCoordinatorPhone').value = coord.phone || '';

            // Populate store checklist
            const container = document.getElementById('storeAssignList');
            if (stores.length === 0) {
                container.innerHTML = '<div style="padding: 12px; color: var(--text-gray); font-size: 14px;">Belum ada toko. Tambahkan toko terlebih dahulu.</div>';
            } else {
                container.innerHTML = stores.map(store => {
                    const isChecked = coord.stores && coord.stores.includes(store.id);
                    return `
                        <label class="coordinator-checkbox">
                            <input type="checkbox" name="assignedStore" value="${store.id}" ${isChecked ? 'checked' : ''}>
                            <span><strong>${store.code}</strong> - ${store.name}</span>
                        </label>
                    `;
                }).join('');
            }

            // Change modal title and button
            document.querySelector('#coordinatorModal .modal-title').textContent = 'Edit Koordinator Area';
            const submitBtn = document.querySelector('#coordinatorModal .btn-primary');
            submitBtn.textContent = 'Update';
            submitBtn.onclick = function() { updateCoordinator(id); };

            document.getElementById('coordinatorModal').classList.add('active');
        }

        function updateCoordinator(id) {
            const coord = coordinators.find(c => c.id === id);
            if (!coord) return;

            const name = document.getElementById('newCoordinatorName').value.trim();
            const area = document.getElementById('newCoordinatorArea').value.trim();
            const phone = document.getElementById('newCoordinatorPhone').value.trim();

            if (!name || !area) {
                alert('Nama dan Area wajib diisi!');
                return;
            }

            // Get selected stores
            const selectedStores = Array.from(
                document.querySelectorAll('input[name="assignedStore"]:checked')
            ).map(cb => parseInt(cb.value));

            // Remove stores from other coordinators first
            coordinators.forEach(c => {
                if (c.id !== id && c.stores) {
                    c.stores = c.stores.filter(storeId => !selectedStores.includes(storeId));
                }
            });

            // Update coordinator
            coord.name = name;
            coord.area = area;
            coord.phone = phone;
            coord.stores = selectedStores;

            saveData();
            closeModal('coordinatorModal');
            renderMasterData();
            initCoordinatorSelect();
            updateDashboard();
            
            // Reset modal
            document.querySelector('#coordinatorModal .modal-title').textContent = 'Tambah Koordinator Area';
            const submitBtn = document.querySelector('#coordinatorModal .btn-primary');
            submitBtn.textContent = 'Simpan';
            submitBtn.onclick = addCoordinator;
            
            // Clear form
            document.getElementById('newCoordinatorName').value = '';
            document.getElementById('newCoordinatorArea').value = '';
            document.getElementById('newCoordinatorPhone').value = '';
            
            alert('‚úÖ Koordinator berhasil diupdate!');
        }

        function deleteCoordinator(id) {
            if (confirm('Yakin hapus koordinator ini?')) {
                coordinators = coordinators.filter(c => c.id !== id);
                saveData();
                renderMasterData();
                initCoordinatorSelect();
            }
        }

        function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            if (!name) {
                alert('Nama kategori wajib diisi!');
                return;
            }

            categories.push(name);
            saveData();
            closeModal('categoryModal');
            renderMasterData();
            
            // Update category dropdown
            const select = document.getElementById('taskCategory');
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            select.appendChild(option);
            
            document.getElementById('newCategoryName').value = '';
        }

        function deleteCategory(idx) {
            if (confirm('Yakin hapus kategori ini?')) {
                categories.splice(idx, 1);
                saveData();
                renderMasterData();
            }
        }

        // Utility functions
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('id-ID', options);
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return date.toLocaleDateString('id-ID', options);
        }

        function refreshTasks() {
            renderTasks();
            alert('‚úÖ Data berhasil di-refresh!');
        }

        // Initialize
        window.onload = function() {
            initCoordinatorSelect();
            updateDashboard();
            renderTasks();
            
            // Set min date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('taskDeadline').setAttribute('min', today);
        };
    </script>
</body>
</html>
